{% extends 'base.html' %}

{% block content %}
<div id="content" class="content">
    <!-- begin row -->
    <div class="row">
        <!-- begin col-3 -->
        <div class="col-sm-7 col-lg-3" style="padding-left: 0;padding-right: 0" >
             <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title" style="margin-bottom: 10px">主机组： <span class="label label-info">已选: <b id="total_chosen_hosts">0</b>台</span></h3>
                    <span id="unfold-all" class="label label-primary">展开</span>
                    <span id="collapse-all" class="label label-primary">收缩</span>
                    <span id="show-all-checked" class="label label-primary">已选</span>
                    <span id="show-all-unchecked" class="label label-primary">未选</span>
                    <span id="check-all" class="label label-primary">全选</span>
                    <span id="uncheck-all" class="label label-primary">取消全选</span>
                </div>
                <div class="panel-body" style="padding-top: 0; padding-left: 10px">
                    <div class="input-group">
                        <input type="text" id="search-host" class="form-control" placeholder="搜索主机..">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-success"><i class="fa fa-search"></i></button>
                        </div>
                    </div>

                    <!--未分类主机-->
                    <div style="padding-top:15px;padding-bottom:0;">
                        <form  class="form-block host-list">
                            <ul class="list-group" style="margin-bottom: 5px">
                                <li style="border:0;padding:0" class="list-group-item">
                                    <span class="badge badge-primary"><i class="fa fa-chevron-down " id="group_toggle_-2"></i></span>
{#                                    <span data_label="group" class="badge badge-primary">全选</span>#}
                                    <b>未分类主机 [{{  request.user.bind_hosts.select_related.count }}]</b>
                                </li>
                            </ul>

                            {% for host in  request.user.bind_hosts.select_related %}
                                <label input_label='host' style='display:none;margin-bottom: 0;margin-left: 10px'>
                                    <input type="checkbox" id="host_{{ host.id }}" style="vertical-align: text-bottom;">{{ host.host.hostname }}  ({{ host.host.ip_address }})
                                </label>
                            {% endfor %}
                        </form>

                    <!--end未分类主机-->

                    <!--分类主机-->
                    {% for g in request.user.business_group.select_related  %}
                    <div style="padding-top:15px;padding-bottom:0;">
                        <!--Block level checkboxes-->
                        <!--===================================================-->
                        <form  class="form-block host-list">
                            <ul class="list-group"  style="margin-bottom: 5px">
                                <li style="border:0;padding:0" class="list-group-item">
                                    <span class="badge badge-primary" data_label='group'><i class="fa fa-chevron-down " id="group_toggle_{{ g.id }}"></i></span>
{#                                        <span data_label="group" class="badge badge-primary">全选</span>#}
                                    <b>{{ g.business}}{{ g.function}}--{{ g.environments}} [{{  g.bindhosttouser_set.select_related.count}}]</b>
                                </li>
                            </ul>

                            {% for host in  g.bindhosttouser_set.select_related %}
                                <label input_label='host' style='display:none;margin-bottom: 0;margin-left: 10px'>
                                    <input type="checkbox" id="host_{{ host.id }}" style="vertical-align: text-bottom;">{{ host.host.hostname }}  ({{ host.host.ip_address }})
                                </label>
                            {% endfor %}
                        </form>
                        <!--===================================================-->
                    </div>
                    {% endfor %}
                    <!-- end 分类主机-->
                    </div>
                </div>
             </div>
        </div>
        <!-- end col-3 -->
    </div>
    <!-- end row -->
</div>

{% endblock %}

{% block js %}
<script>
    $(document).ready(function() {
        App.init();
    });
       // $("label[input_label='host']").fadeOut();
       $("#unfold-all").click(function(){
          $("label[input_label='host']").fadeIn();
       }) ;
      $("#collapse-all").click(function(){
          $("label[input_label='host']").fadeOut();
       }) ;
      $("#show-all-checked").click(function(){
          $("label[input_label='host']").css('display','none').children().filter(":checked").parent().css('display','inline-block');
       }) ;
      $("#show-all-unchecked").click(function(){
          $("label[input_label='host']").css('display','none').children().not(":checked").parent().css('display','inline-block');
       }) ;
       $("#check-all").click(function(){
           $("label[input_label='host']").children().prop('checked','true');
       }) ;
       $("#uncheck-all").click(function(){
           $("label[input_label='host']").children().removeProp("checked");
       }) ;

       $("span[data_label='group']").click(function(){
            $(this).parent().parent().nextAll().css('display','inline-block');
{#           var btn_val = $(this).html();#}
{#           if (btn_val == '全选'){#}
{#               var hosts = $(this).parent().parent().nextAll().addClass("active");#}
{#               $(this).html("取消");#}
{#           }else{#}
{#               var hosts = $(this).parent().parent().nextAll().removeClass("active");#}
{#               $(this).html("全选");#}
           });//end span[data_label='group
      $("#search-host").change(function(){
         //console.log($(this).val());
         var search_text =  $(this).val();
         $("label[input_label='host']").fadeOut();
         var host_nodes = $("label[input_label='host']:contains("+  search_text+ ")")
          host_nodes.fadeIn();
         if (host_nodes.length ==0){
             $(this).val(search_text +":找不到主机!");
         }
         //console.log(host_nodes);
      });
      $("button[data-toggle='collapse']").click(function(){
          $(this).parent().parent().next().fadeToggle(300)
      });//end button toggle
    $('.selectpicker').selectpicker({
          style: 'btn-info',
          size: 4
      });
</script>
{% endblock %}